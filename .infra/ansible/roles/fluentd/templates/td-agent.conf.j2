####
## Source descriptions:
##

<source>
  @type syslog
  port 5140
  bind 127.0.0.1
  tag syslog
</source>

<source>
 type tail
 path /var/log/foo/auth.log
 pos_file /var/log/auth.pos
 tag authlog
 format /^(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$/
</source>

<source>
  type tail
  path /var/log/nginx/access.log
  pos_file /var/log/td-agent/nginx-access.pos
  tag nginxlog
  format nginx
</source>

####
## Filter descriptions:
##

####
## Match descriptions:
##

<match authlog.**>
 @type elasticsearch
 logstash_format true
 logstash_prefix "server-authlogs"
 include_tag_key true
 flush_interval 5s
 logstash_dateformat %Y.%m.%d
 time_precision 3
 {% for host in groups['log'] %}
 host {{ hostvars[host]['ansible_facts']['eth0']['ipv4']['address'] }}
 {% endfor %}

</match>

<match syslog.**>
  @type elasticsearch
  {% for host in groups['log'] %}
  host {{ hostvars[host]['ansible_facts']['eth0']['ipv4']['address'] }}
  {% endfor %}
  logstash_format true
  logstash_prefix "server-syslogs"
  flush_interval 10s
</match>

<match nginxlog.**>
  @type elasticsearch
  logstash_format true
  logstash_prefix "nginxlogs"
  {% for host in groups['log'] %}
  host {{ hostvars[host]['ansible_facts']['eth0']['ipv4']['address'] }}
  {% endfor %}
</match>
