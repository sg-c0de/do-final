upstream {{ app_name }} {
	server {{ upstream_target }}:{{ app_port }};
}

server {
	listen 443 ssl;

	ssl_certificate /etc/letsencrypt/live/{{ inventory_hostname }}/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/{{ inventory_hostname }}/privkey.pem;

	server_name {{ inventory_hostname }};

	location / {
		proxy_set_header    X-Real-IP       $remote_addr;
		proxy_set_header    Host            $host;
		proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_http_version  1.1;
		proxy_set_header    Connection "";

		proxy_read_timeout 2s;
		proxy_connect_timeout 2s;

		proxy_buffer_size   256k;
		proxy_buffers   4 512k;
		proxy_busy_buffers_size   512k;

		proxy_pass http://{{ app_name }};
	}
}
